---
id: circuits
title: 回路とトランザクション
sidebar_label: Circuits and Transactions
description: "Nightfallの回路の種類"
keywords:
  - docs
  - polygon
  - nightfall
  - circuits
  - deposit
  - transfer
image: https://matic.network/banners/matic-network-16x9.png
---

回路は、トランザクションが正しいと見なされるために従う必要があるルールを定義するために使用されます。回路には大きく分けて3種類があり、トランザクションのタイプごとに1つずつ存在します：

- [デポジット](#deposit)
- [転送](#transfer)
- [引き出す](#withdraw)

すべてのトランザクションには、これらの回線で指定された制約に従うZKプルーフが含まれます。ユーザは、ウォレットを使用するか、クライアントサーバを使用してこのプルーフを作成します。プルーフは、次のすべてのケースが当てはまる場合にだけ生成されます：

- 新しい[コミットメント](./commitments#what-are-commitments)は有効です
- 古い[コミットメント](./commitments#what-are-commitments)は有効であり、送信者が所有しています
- [ヌールファイア]（./commitments#what-are-nullifiers）は有効です
- Merkle Treeパス/ルートは有効です
- コミットメントを含む暗号テキストは有効です


## デポジット {#deposit}
デポジットは、公開的に表示されるERCトークンを、元のトークンと同じ値またはトークンIDを持つトークンコミットメントと、意図したコミットメント所有者のNightfallパブリック鍵に変換します。

デポジットZKプルーフは、証明者が有効なコミットメントを作成したことを証明します$Z_A$ with a public key $pk_A$。

次に、回路は次のことをチェックします $Z_A$ == H(@ | ɑ | $pk_A$| σ)
デポジットトランザクションの漏洩情報には、新しいコミットメントを鋳造したアドレスと、使用されているERCトークンのアドレスと値が含まれます。

![](../imgs/deposit.png)

## 転送 {#transfer}
転送は、以前の約束を無効にし、最大2つの新しい約束を作成することによって、2つの当事者間で同じ資産の約束を最大2つ送信できるようにします：
- 1つは、転送されたアンマウントの値を含むレシーバに送信されます
- 別の値は、変更の値（コミットメントの値の合計から転送された値を引いた値の差）を使用して作成され、送信者が所有します。

転送ZKプルーフは、証明者がMerkle Treeに存在する古いコミットメントを最大2つ無効にし、新しいコミットメントを1つ作成し、その情報を受信者のために暗号化したことを証明します。

いずれの場合も、漏洩した情報は、Ethereumのアドレスが送信者が所有するコミットメントプール間のコミットメントを無効にし、新しいコミットメントが作成されたことです。新しい所有者に関する情報。コミットメントが使用されたか、転送された金額はプライベートのままです。

最初の図では、既存のコミットメント（またはコミットメント）を無効にし、`transaction`データ構造に情報を追加する手順について説明します。

![](../imgs/transfer_a.png)

2つ目の図は、新たに作成されたコミットメントを生成および暗号化するために必要な手順を示しています。

![](../imgs/transfer_b.png)

## 引き出す {#withdraw}
引き出しは、既存のNightfallコミットメントを無効にして、焼き付けられたコミットメントと同じ値とトークンIDを持つパブリックに表示可能なERCトークンに変換する操作です。引き出すことはデポジットとは反対の操作です。譲渡と同様に、引き落としは最大2つのコミットメントを入力として受け入れます。

引き出しZKプルーフは、証明者がMerk leTreeに存在した2つまでの古いコミットメントを無効にしたことを証明します。

引き出し中に漏れた情報には、コミットメントを脱退したアドレスのアドレス、引き出されたトークンの値/トークンID、およびアドレスが含まれます。

![](../imgs/withdraw.png)

### 冷却オフ期間 {#cooling-off-period}

引き出しを完了するには、1週間の`COOLING OFF`期間が必要です。これは、新しいブロックは、一部のチャレンジャーが不正プルーフを提出するまで正しいと想定されるため、Nightfallの楽観的な性質によるものです。ファンドは1週間が経過するまで保有され、L1に引き出せます。

# 手数料 {#fees}

プロポーザーは、手数料と引き換えに、着信トランザクションを受け取り、L2ブロックにロールします。提案に支払われる手数料は、トランザクションによって2種類あります：
- デポジットはL1で直接手数料ETHを支払います。
- 転送と引き出しは、L2のMATICで手数料を支払います。
