---
id: circuits
title: 서킷 및 트랜잭션
sidebar_label: Circuits and Transactions
description: "나이트폴의 서킷 유형"
keywords:
  - docs
  - polygon
  - nightfall
  - circuits
  - deposit
  - transfer
image: https://matic.network/banners/matic-network-16x9.png
---

서킷은 트랜잭션이 올바른 것으로 간주되기 위해 따라야 하는 규칙을 정의하는 데 사용됩니다. 광범위하게 각 트랜잭션 유형당 하나씩 세 가지 유형의 서킷이 있습니다.

- [입금](#deposit)
- [이전](#transfer)
- [출금](#withdraw)

모든 트랜잭션에는 이러한 서킷에 명시된 제약을 따르는 ZK 증명이 포함됩니다. 사용자는 지갑을 사용하거나
클라이언트 서버를 통해 이 증명을 구성합니다.
증명은 다음의 경우가 모두 참인 경우에만 생성됩니다.

- 새로운 [커밋먼트](./commitments#what-are-commitments)가 유효하다.
- 이전 [커밋먼트](./commitments#what-are-commitments)가 유효하고 발신자가 이를 소유한다.
- [널리파이어](./commitments#what-are-nullifiers)가 유효하다.
- 머클 트리 경로/루트가 유효하다.
- 커밋먼트를 포함하는 암호문이 유효하다.


## 입금 {#deposit}
입금은 공개적으로 보이는 ERC 토큰을 원래 토큰과 동일한 가치 또는 토큰 아이디 그리고
의도된 커밋먼트 소유자의 나이트폴 공개 키를 포함하는 토큰 커밋먼트로 변환합니다.

입금 ZK 증명은 증명자가 유효한 커밋먼트 $Z_A$ with a public key $pk_A$를 생성했음을 증명합니다.

그런 다음 서킷은 $Z_A$ == H(@ | ɑ | $pk_A$ | σ)를 확인합니다.
입금 트랜잭션에서 유출되는 정보로는 새로운 커밋먼트를 발행한 주소와 사용 중인 ERC 토큰의 주소 및 가치 등이 있습니다.

![](../imgs/deposit.png)

## 이전 {#transfer}
이전은 과거 커밋먼트를 무효화하고 최대 2개의 커밋먼트를 생성하므로 두 당사자 간에 동일한 자산에 대해 최대 2개의 커밋먼트를 전송할 수 있습니다.
- 하나는 리씨버에게 전송되며 이전 가치를 포함합니다.
- 다른 하나는 차액의 가치(사용된 커밋먼트의 가치 합계 - 이전된 가치)를 사용하여 생성되며 전달자가 소유합니다.

이전 ZK 증명은 증명자가 머클 트리에 존재한 최대 2개의 과거 커밋먼트를 무효화하고 새로운 커밋먼트를 생성했으며 수신자를 위해 해당 정보를 암호화했음을 증명합니다.

어느 경우든 전달자가 소유한 커밋먼트 풀의 커밋먼트를 이더리움 주소가 무효화했다는 정보와
새로운 커밋먼트가 생성되었다는 정보가 유출됩니다.
새로운 소유자, 사용된 커밋먼트 또는 이전 금액에 대한 정보는 비공개로 유지됩니다.

첫 번째 다이어그램은 기존 커밋먼트를 무효화하고 `transaction` 데이터 구조에 정보를 추가하는 단계를 설명합니다.

![](../imgs/transfer_a.png)

두 번째 다이어그램은 새로운 커밋먼트를 생성하고 암호화하는 데 필요한 단계를 설명합니다.

![](../imgs/transfer_b.png)

## 출금 {#withdraw}
출금은 기존 나이트폴 커밋먼트를 무효화하고 소각된 커밋먼트와 동일한 가치 및 토큰 아이디를 갖는 공개적으로 가시화된 ERC 토큰으로 이를 변환하는 작업입니다. 출금은 입금과 상반되는 작업입니다. 이전과 마찬가지로 출금은 최대 2개의 커밋먼트를 입력으로 허용합니다.

출금 ZK 증명은 증명자가 머클 트리에 존재한 2개의 과거 커밋먼트를 무효화했음을 증명합니다.

출금 중에 유출되는 정보로는 커밋먼트를 철회한 주소, 인출된 토큰의 가치/아이디 및 주소 등이 있습니다.

![](../imgs/withdraw.png)

### 쿨링 오프 기간 {#cooling-off-period}

출금이 최종 확정되려면 일주일의 `COOLING OFF` 기간이 필요합니다. 이는 나이트폴의 낙관적 특성 때문입니다. 새로운 블록은 일부 챌린저가 사기 증명을 제출할 때까지 올바른 것으로 추정됩니다. 자금은 일주일이 지날 때까지 보관되며 L1으로 출금될 수 있습니다.

# 수수료 {#fees}

제안자는 들어오는 트랜잭션을 수신하고 수수료에 대한 대가로 이를 L2 블록에 롤링합니다. 트랜잭션에 따라 제안자에게 지급되는 두 가지 다른 유형의 수수료가 있습니다.
- 입금은 L1에서 직접 ETH로 수수료를 지불합니다.
- 이전 및 출금은 L2에서 매틱으로 수수료를 지불합니다.
