---
id: circuits
title: วงจรและธุรกรรมต่างๆ
sidebar_label: Circuits and Transactions
description: "ประเภทของวงจรบน Nightfall"
keywords:
  - docs
  - polygon
  - nightfall
  - circuits
  - deposit
  - transfer
image: https://matic.network/banners/matic-network-16x9.png
---

วงจรใช้เพื่อกำหนดกฎเกณฑ์ที่ธุรกรรมต้องปฏิบัติตามจึงจะถือว่าถูกต้องมีวงจรสามประเภทกว้าง ๆ หนึ่งวงจรสำหรับธุรกรรมแต่ละประเภท:

- [ฝาก](#deposit)
- [โอน](#transfer)
- [ถอน](#withdraw)

ทุกธุรกรรมมี ZK Proof ตามข้อจำกัดที่ระบุในวงจรเหล่านี้ผู้ใช้สร้างหลักฐานนี้โดยใช้กระเป๋าเงินหรือผ่านเซิร์ฟเวอร์ไคลเอ็นต์หลักฐานจะถูกสร้างขึ้นก็ต่อเมื่อทุกกรณีต่อไปนี้เป็นจริง:

- [ข้อผูกมัด](./commitments#what-are-commitments)ใหม่ถูกต้อง
- [ข้อผูกมัด](./commitments#what-are-commitments)เก่านั้นถูกต้องและเป็นเจ้าของโดยผู้ส่ง
- [การทำให้เป็นโมฆะ] (./commitments#what-are-nullifiers) ถูกต้อง
- เส้นทาง/รูทของ Merkle Tree ถูกต้อง
- ข้อความเข้ารหัสที่มีข้อผูกมัดนั้นถูกต้อง


## ฝาก {#deposit}
เงินฝากแปลงโทเค็น ERC ที่เปิดเผยต่อสาธารณะเป็นสัญญาผูกมัดโทเค็นที่มีค่าหรือรหัสโทเค็นเดียวกันกับโทเค็นดั้งเดิมและคีย์สาธารณะ Nightfall ของเจ้าของสัญญาผูกมัดที่ตั้งใจไว้

หลักฐานเงินฝาก ZK พิสูจน์ได้ว่าผู้พิสูจน์ได้สร้างข้อผูกพันที่ถูกต้อง$Z_A$ with a public key $pk_A$

วงจรจึงตรวจสอบว่า $Z_A$ == H(@ | ɑ | $pk_A$ | σ)ข้อมูลที่รั่วไหลของธุรกรรมการฝากเงินรวมถึงที่อยู่ที่สร้างข้อผูกพันใหม่และที่อยู่และมูลค่าของโทเค็น ERC ที่ใช้

![](../imgs/deposit.png)

## โอน {#transfer}
การโอนช่วยให้สามารถส่งข้อผูกมัดของสินทรัพย์เดียวกันได้ถึงสองรายการระหว่างสองฝ่ายโดยการทำให้ข้อผูกมัดก่อนหน้านี้เป็นโมฆะและสร้างข้อผูกมัดใหม่ได้ถึงสองรายการ:
- หนึ่งรายการจะถูกส่งไปยังผู้รับซึ่งมีมูลค่าของจำนวนเงินที่โอน
- อีกหนึ่งรายการจะถูกสร้างขึ้นด้วยมูลค่าของการเปลี่ยนแปลง (ความแตกต่างระหว่างผลรวมของมูลค่าข้อผูกมัดที่ใช้ลบมูลค่าที่โอน) และเป็นเจ้าของโดยผู้ส่ง

หลักฐานการโอน ZK พิสูจน์ว่าผู้พิสูจน์ได้ลบล้างจ้อผูกมัดเก่าสองรายการที่มีอยู่ใน Merkle Tree สร้างรายการใหม่หนึ่งรายการ และเข้ารหัสข้อมูลสำหรับผู้รับ

ไม่ว่าในกรณีใด ข้อมูลที่รั่วไหลออกมาจะเป็นที่อยู่ Ethereum ได้ทำให้ข้อผูกมัดเป็นโมฆะระหว่างกลุ่มข้อผูกมัดที่ผู้ส่งเป็นเจ้าของและมีการสร้างข้อผูกมัดใหม่ข้อมูลเกี่ยวกับเจ้าของใหม่ซึ่งใช้ข้อผูกมัดหรือจำนวนเงินที่โอนยังคงเป็นส่วนตัว

ไดอะแกรมแรกจะอธิบายขั้นตอนต่างๆ เกี่ยวกับการทำให้ข้อผูกมัดที่มีอยู่เป็นโมฆะ (หรือข้อผูกมัด) ที่มีอยู่ และเพิ่มข้อมูลลงใน`transaction`โครงสร้างข้อมูล

![](../imgs/transfer_a.png)

ไดอะแกรมที่สองอธิบายขั้นตอนที่จำเป็นในการสร้างและเข้ารหัสข้อผูกมัดที่สร้างขึ้นใหม่

![](../imgs/transfer_b.png)

## ถอน {#withdraw}
การถอนคือการดำเนินการยกเลิกข้อผูกพัน Nightfall ที่มีอยู่และแปลงเป็นโทเค็น ERC ที่เปิดเผยต่อสาธารณะด้วยค่าและรหัสโทเค็นเดียวกันกับข้อผูกมัดที่ถูกเผาการถอนเป็นการดำเนินการที่ตรงกันข้ามกับการฝากเงินเช่นเดียวกับการโอน การถอนจะยอมรับเป็นข้อมูลป้อนเข้าถึงสองข้อผูกมัด

หลักฐานการรถอน ZK พิสูจน์ว่าผู้พิสูจน์ได้ทำให้ข้อผูกมัดเก่าสองข้อซึ่งมีอยู่ใน MerkleTree เป็นโมฆะ

ข้อมูลรั่วไหลระหว่างการถอน รวมถึง ที่อยู่ของที่อยู่ที่ถอนข้อผูกมัดและมูลค่า/รหัสโทเค็นและที่อยู่ของโทเค็นที่ถูกเพิกถอน

![](../imgs/withdraw.png)

### ระยะพักตัว {#cooling-off-period}

การถอนต้องใช้`COOLING OFF`ระยะเวลาหนึ่งสัปดาห์ในการสรุปนี่เป็นเพราะธรรมชาติในแง่ดีของ Nightfall เนื่องจากการบล็อกใหม่จะถือว่าถูกต้องจนกว่า challenger บางรายจะส่งหลักฐานการฉ้อโกงเงินจะถูกเก็บไว้จนกว่าจะผ่านไปหนึ่งสัปดาห์และสามารถถอนออกไปยัง L1 ได้

# ค่าธรรมเนียม {#fees}

ผู้เสนอใช้ธุรกรรมที่เข้ามาและม้วนเป็นบล็อก L2 เพื่อแลกกับค่าธรรมเนียมมีค่าธรรมเนียมสองประเภทที่จ่ายให้กับข้อเสนอขึ้นอยู่กับธุรกรรม:
- เงินฝากชำระค่าธรรมเนียม ETH โดยตรงใน L1
- การโอนและการถอนจ่ายค่าธรรมเนียมใน MATIC ใน L2
