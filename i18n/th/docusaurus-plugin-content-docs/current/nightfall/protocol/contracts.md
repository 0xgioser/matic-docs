---
id: contracts
title: สัญญาอัจฉริยะ
sidebar_label: Smart Contracts
description: "ชิลด์ ผู้เสนอ ความท้าทาย และการคำนวณ Merkle Tree"
keywords:
  - docs
  - polygon
  - nightfall
  - smart
  - contracts
  - shield
image: https://matic.network/banners/matic-network-16x9.png
---

สัญญากำหนดกฎเกณฑ์ที่นักแสดง Nightfall แต่ละคนต้องปฏิบัติตามเพื่อดำเนินการในเครือข่ายสัญญาอัจฉริยะรวมถึง:

- [Shield.sol](#shield)
- [Proposers.sol](#proposers)
- [Challenges.sol](#challenges)
- [MerkleTree_Computations.sol](#merkletree_computations)

## ชิลด์ {#shield}
สัญญานี้ทำให้ผู้ใช้สามารถส่งธุรกรรมสำหรับการประมวลผลโดยผู้เสนอถ้าเป็นธุรกรรมการฝาก ก็จะรับเงินนอกจากนี้ยังอนุญาตให้ทุกคนร้องขอให้อัปเดตสถานะของสัญญาชิลด์ (รายการรูทข้อผูกมัดและตัวลบข้อมูล)เมื่อสถานะได้รับการอัปเดต การถอนใดๆ ในการอัปเดตจะได้รับการดำเนินการ

ไม่จำเป็นต้องโพสต์การโอนหรือถอนธุรกรรมไปยังบล็อคเชน: มันทำหน้าที่เป็นกระดานข้อความสำหรับผู้เสนอเพื่อรับธุรกรรมและรวมไว้ในบล็อกเลเยอร์ 2

เนื่องจาก Nightfall โต้ตอบกับสัญญา ERC จริง การตรวจสอบต่อไปนี้จึงไม่สามารถทำให้เป็นแบบส่วนตัวได้:

- ในระหว่าง**การฝาก/ถอน** ที่อยู่โทเค็น ERC นั้นถูกต้อง
- ในระหว่าง**การฝากเงิน** ผู้ใช้มียอดคงเหลือหรือเป็นเจ้าของโทเค็นเพื่อสร้างข้อผูกมัด

## ผู้เสนอ {#proposers}
สัญญาประกอบด้วยฟังก์ชันสำหรับการลงทะเบียน ยกเลิกการลงทะเบียน ชำระเงิน และหมุนเวียนผู้เสนอ และเสนอบล็อกเลเยอร์ 2 ใหม่ให้กับบล็อกเชนNightfall เวอร์ชันแรกยอมรับเฉพาะ Boot Proposer เดียวที่ดำเนินการโดย Polygonในเวอร์ชันต่อๆ ไป ข้อจำกัดนี้จะถูกยกเลิกโดยที่ผู้เสนอหลายคนจะได้รับอนุญาต

## ความท้าทาย {#challenges}
การทำงานทำให้บล็อกถูกท้าทายว่าไม่ถูกต้อง

## MerkleTree_Stateless {#merkletree_stateless}
เวอร์ชันดั้งเดิมที่ไม่มีสถานะ (ฟังก์ชันบริสุทธิ์) `MerkleTree.sol`ถูกใช้`Challenges.sol`เพื่อช่วยคำนวณความท้าทายในห่วงโซ่

## สัญญาอื่นๆ {#other-contracts}
- `Utils.sol` - รวบรวมฟังก์ชันการทำงานที่ใช้ในสัญญาหลายฉบับ หรือหากปล่อยไว้แบบอินไลน์ จะส่งผลต่อความสามารถในการอ่านโค้ด
- `Config.sol` - เก็บค่าคงที่ คล้ายกับไฟล์กำหนดค่า Node.js
- `Structures.sol` - กำหนดโครงสร้างสากล, enums, เหตุการณ์, การแมปและตัวแปรสถานะ
ทำให้ง่ายต่อการค้นหา

## อัพเกรดได้ {#upgradability}
อย่างน้อยในตอนแรก Polygon ยังคงความสามารถในการอัพเกรดสัญญา Nightfall หลังจากการปรับใช้ราใช้ Openzeppelin [Upgrades Plugins](https://docs.openzeppelin.com/upgrades-plugins/1.x/) สำหรับ Truffle ในการทำเช่นนั้น

Polygon ใช้โมดูล[ตัวปรับใช้](https://github.com/EYBlockchain/nightfall_3/tree/master/nightfall-deployer)เพื่ออัปเกรดสัญญา`deployer`มี 4 การย้ายข้อมูลที่เก็บไว้ในโฟลเดอร์การย้ายข้อมูลการย้ายข้อมูลสามครั้งแรกจะดำเนินการปรับใช้ 'ปกติ' ของชุดสัญญา Polygon Nightfallอย่างไรก็ตามพวกเขาตรวจสอบให้แน่ใจว่าสัญญาทั้งหมด (แต่ไม่ใช่ไลบรารี) ถูกปรับใช้กับพร็อกซีเพื่อให้สามารถอัปเกรดได้ในภายหลังการย้ายครั้งที่สี่ใช้เพื่ออัปเกรดสัญญา
