---
id: commitments
title: 承诺和废弃值
sidebar_label: Commitment and Nullifiers
description: "单笔和双重转账。"
keywords:
  - docs
  - polygon
  - nightfall
  - commitment
  - nullifier
image: https://matic.network/banners/matic-network-16x9.png
---


## 什么是承诺？ {#what-are-commitments}
承诺是一种密码学原语，供用户在承付一定价值的同时，对其他人隐藏这一信息，并可稍后再公开这一承付价值。价值和接受者的保密性是以这种方式实现的。

每次用户使用 Nightfall 执行交易时，浏览器钱包都会计算零知识证明 (ZKP) 并创建（或废弃）承诺。例如，您在存入或转账时创建承诺，而在转账或提现时废弃承诺。

ZKP 计算以[回路](../protocol/circuits.md)为依据，交易必须遵守后者定义的规则，才会被视为正确。

承诺用于隐藏以下属性：
- **代币的 ERC 地址**
- **代币 ID**
- **价值**
- **所有者**

承诺存储在 *Merkle 树*结构中。此 *Merkle 树*的根存储在链上。

![](../imgs/commitment.png)

### UTXO {#utxo}
承诺创建于存款和转账期间，并在转账和提现交易期间花费掉。**多个承诺不进行合并**。花费承诺时，所花费的承诺价值上限为所拥有最多两个承诺的价值之和。

目前，Nightfall 中使用的 ZKP 转账和提现回路的上限为 2 项输入减去 2 项输出（转账/提现承诺和二者之差），剔除付款部分。如果转账者的承诺集合主要由价值较低的承诺（粉尘）组成，他们可能会发现未来的转账难以进行。

请看以下价值集合

- **集合 A**：[1, 1, 1, 1, 1, 1]
- **集合 B**：[2, 2, 2]
- **集合 C**：[2, 4]

虽然上述三个集合各自的加总是相等的，但集合 *A*、*B* 和 *C* 可进行转账交易的最大价值分别为 2、4 和 6。这就是为什么较高的承诺价值更受青睐。系统采用的承诺选择策略通过优先花费小额承诺来降低这一风险，同时也可最大限度地减少粉尘承诺的产生。


## 什么是废弃值？ {#what-are-nullifiers}
**废弃值**是承诺和废弃密钥组合产生的结果。废弃值一旦上链广播，该承诺就被视为已花费。废弃值作为区块提案期间的数据的一部分存储在链上。

![](../imgs/nullifier.png)



