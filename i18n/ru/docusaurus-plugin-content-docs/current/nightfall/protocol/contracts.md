---
id: contracts
title: Смарт-контракты
sidebar_label: Smart Contracts
description: "Shield, авторы предложений, вызовы и вычисления дерева Меркла."
keywords:
  - docs
  - polygon
  - nightfall
  - smart
  - contracts
  - shield
image: https://matic.network/banners/matic-network-16x9.png
---

Контракты определяют правила, которым должен следовать каждый участник Nightfall для работы в сети.
Смарт-контракты включают:

- [Shield.sol](#shield)
- [Proposers.sol](#proposers)
- [Challenges.sol](#challenges)
- [MerkleTree_Computations.sol](#merkletree_computations)

## Shield {#shield}
Этот контракт позволяет пользователю отправить транзакцию для обработки автором предложения. Если это транзакция депозита, будет взята оплата.
Контракт также позволяет любому лицу запросить обновление состояния контракта Shield (корень обязательства и списки обнулителей).
Когда состояние обновится, будут обработаны любые выводы в обновлении.

Нет фундаментальной необходимости публиковать транзакцию трансфера или вывода в блокчейне: он просто выступает в качестве доски объявлений для
авторов предложений, чтобы те могли выбрать транзакции и включить их в блок второго уровня.

Поскольку Nightfall взаимодействует с реальными контрактами ERC, следующие проверки не могут быть выполнены приватно:

- Во время **депозита/вывода** адрес токена ERC является действительным.
- Во время **депозита** пользователь имеет остаток средств или владеет токеном, чтобы создать обязательство.

## Авторы предложений {#proposers}
Контракт включает функциональные возможности для регистрации, отмены регистрации, оплаты и ротации авторов предложений, а также для предложения нового блока второго уровня в блокчейн.
Первая версия Nightfall принимает только одного автора предложения по загрузке, действующего под управлением Polygon. В предстоящих версиях это ограничение будет отменено, так что будут допускаться множественные авторы предложений.

## Вызовы {#challenges}
Эта функциональная возможность позволяет оспаривать блок как неправильный.

## MerkleTree_Stateless {#merkletree_stateless}
Версия без отслеживания состояния (чистая функция) оригинального `MerkleTree.sol`, используемая `Challenges.sol` для содействия вычислению вызовов блока в цепочке.

## Другие контракты {#other-contracts}
- `Utils.sol` объединяет функциональные возможности, которые либо используются в множественных контрактах, либо, будучи оставленным встроенным, повлияют на считываемость кода.
- `Config.sol` содержит константы, аналогичные файлу конфигурации Node.js.
- `Structures.sol` определяет глобальные структуры, перечислимые типы, события, сопоставления и переменные состояния. Это облегчает их поиск.

## Возможность апгрейдов {#upgradability}
По крайней мере первоначально Polygon сохраняет возможность апгрейда контрактов Nightfall после развертывания.
Для этой цели мы используем [плагины для апгрейдов](https://docs.openzeppelin.com/upgrades-plugins/1.x/) Openzeppelin для Truffle.

Polygon использует модуль [развертывателя](https://github.com/EYBlockchain/nightfall_3/tree/master/nightfall-deployer) для апгрейда контрактов.
`deployer` имеет 4 миграции, хранящиеся в папке миграции.
Первые три миграции выполняют «нормальное» развертывание пакета контрактов Polygon Nightfall. Они,
вместе с тем, действительно обеспечивают, чтобы все контракты (но не библиотеки) были развернуты с прокси-сервером, чтобы обеспечить возможность их
апгрейда в дальнейшем. Четвертая миграция используется для апгрейда контрактов.
