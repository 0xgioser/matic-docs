---
id: circuits
title: Схемы и транзакции
sidebar_label: Circuits and Transactions
description: "Типы схем в Nightfall"
keywords:
  - docs
  - polygon
  - nightfall
  - circuits
  - deposit
  - transfer
image: https://matic.network/banners/matic-network-16x9.png
---

Схемы используются для определения правил, которым должна следовать транзакция, чтобы считаться правильной. В общих чертах существует три типа схем, по одному для каждого типа транзакции:

- [Депозит](#deposit)
- [Трансфер](#transfer)
- [Вывод](#withdraw)

Каждая транзакция включает доказательство с нулевым разглашением, следующее ограничениям, указанным в этих схемах. Пользователи формируют это доказательство с помощью кошелька
или посредством клиент-сервера.
Доказательство генерируется только в том случае, если выполнены все следующие условия:

- Новое [обязательство](./commitments#what-are-commitments) является действительным
- Старое [обязательство](./commitments#what-are-commitments) является действительным и принадлежит отправителю
- [Обнулитель] (./commitments#what-are-nullifiers) является действительным
- Путь/корень дерева Меркла является действительным
- Зашифрованный текст, содержащий обязательство, является действительным


## Депозит {#deposit}
Депозиты конвертируют публично видимые токены ERC в обязательство по токенам, которое имеет то же значение или тот же идентификатор токена, как и первоначальный токен,
а также публичный ключ Nightfall намеченного владельца обязательства.

Доказательство депозита с нулевым разглашением подтверждает, что доказыватель создал действительное обязательство $Z_A$ with a public key $pk_A$.

Затем схема проверяет, что $Z_A$ == H(@ | ɑ | $pk_A$ | σ)
Раскрываемая информация транзакции депозита включает адрес, который сминтовал новое обязательство, а также адрес и значение используемого токена ERC.

![](../imgs/deposit.png)

## Трансфер {#transfer}
Трансферы обеспечивают возможность пересылки до двух обязательств по одному и тому же активу между двумя сторонами посредством аннулирования предыдущих обязательств и создания до двух новых обязательств.
- Одно из них, в котором содержится значение пересылаемого количества, будет отправлено получателю.
- Другое будет создано со значением изменения (разницы между суммой значений используемых обязательств за вычетом пересылаемого значения) и будет принадлежать пересылающему лицу.

Доказательство трансфера с нулевым разглашением подтверждает, что доказыватель аннулировал до двух старых обязательств, которые существовали в дереве Меркла, создал два новых обязательства и зашифровал информацию для получателя.

В любом случае раскрывается информация о том, что адрес Ethereum аннулировал обязательства
в пуле обязательств, принадлежащем пересылающему лицу, и что созданы новые обязательства.
Информация о новом владельце, о том, какие обязательства были потрачены, или о пересылаемом количестве остается конфиденциальной.

На первой схеме представлены шаги, связанные с аннулированием существующего обязательства (или обязательств) и добавлением этой информации в структуру данных `transaction`.

![](../imgs/transfer_a.png)

На второй схеме представлены шаги, необходимые для генерации и шифрования вновь созданного обязательства.

![](../imgs/transfer_b.png)

## Вывод {#withdraw}
Вывод — это операция аннулирования существующего обязательства Nightfall и его конвертации в публично видимые токены ERC с тем же значением и тем же идентификатором токена, как у сожженного обязательства. Вывод — это операция, противоположная депозиту. Как и в случае трансферов, выводы принимают в качестве исходных данных до двух обязательств.

Доказательство вывода с нулевым разглашением подтверждает, что доказыватель аннулировал до двух старых обязательств, которые существовали в дереве Меркла.

Информация, раскрываемая во время вывода, включает адрес адреса, который вывел обязательство, а также значение/идентификатор токена и адрес выводимого токена.

![](../imgs/withdraw.png)

### Период обдумывания {#cooling-off-period}

Для финализации вывода требуется период `COOLING OFF`, равный одной неделе. Это обусловлено оптимистичным характером Nightfall, поскольку новый блок считается правильным до тех пор, пока какой-либо оспаривающий узел не представит доказательство мошенничества. Средства удерживаются до истечения одной недели, а затем могут быть выведены на первый уровень.

# Комиссии {#fees}

Автор предложения принимает входящие транзакции и свертывает их в блок второго уровня в обмен на комиссию. Существуют два различных типа комиссий, выплачиваемых автору предложения в зависимости от транзакции:
- За депозиты выплачиваются комиссии в ETH непосредственно на первом уровне.
- За депозиты и выводы выплачиваются комиссии в MATIC на втором уровне.
